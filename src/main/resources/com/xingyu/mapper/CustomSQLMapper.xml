<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xingyu.mapper.CustomSQLMapper" >

  <!--
      批量插入学生评估得分纪录
    -->
  <insert id="listInsertAssessScore" parameterType="java.util.List">
    insert into sd_assess_score (archive_no,assess_times,item_id,score,remark)
    values
    <foreach collection="assessScoreList" index="index" item="item" separator=",">
      (#{item.archiveNo,jdbcType=VARCHAR},
        #{item.assessTimes,jdbcType=VARCHAR},
        #{item.itemId,jdbcType=INTEGER},
        #{item.score,jdbcType=VARCHAR},
        #{item.remark,jdbcType=VARCHAR})
    </foreach>
  </insert>

  <resultMap id="SdAssessScoreStatMap" type="com.xingyu.domain.po.SdAssessScoreCnt">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 23 23:24:00 CST 2019.
    -->
    <result column="archive_no" jdbcType="VARCHAR" property="archiveNo" />
    <result column="assess_times" jdbcType="VARCHAR" property="assessTimes" />
    <result column="assess_date" jdbcType="DATE" property="assessDate" />
    <result column="sd_age" jdbcType="VARCHAR" property="sdAge" />
    <result column="assess_teacher" jdbcType="VARCHAR" property="assessTeacher" />
    <result column="assess_age" jdbcType="VARCHAR" property="assessAge" />
    <result column="develop_age" jdbcType="VARCHAR" property="developAge" />
    <result column="item_id" jdbcType="INTEGER" property="itemId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="score" jdbcType="VARCHAR" property="score" />
    <result column="score_cnt" jdbcType="INTEGER" property="scoreCnt" />
  </resultMap>

  <select id="statSdAssessScoreAhead" resultMap="SdAssessScoreStatMap" >
    select a.*,c2.item_id,c2.`name`,b.score,count(b.score) as score_cnt
    from sd_assess_times a,sd_assess_score b,sd_assess_item c1,sd_assess_item c2
    where
    <if test="archiveNo != null">
      a.archive_no = #{archiveNo,jdbcType=VARCHAR} and
    </if>
    a.archive_no=b.archive_no and b.item_id=c1.item_id and c1.catalog_first=c2.item_id
    and c1.catalog_first in(1,2,3,4,5,6,7)
    GROUP BY a.assess_times,c2.item_id,b.score
    ORDER BY a.assess_date,c2.item_id;
  </select>


  <select id="statSdAssessScoreLast" resultMap="SdAssessScoreStatMap" >
    select a.*,c2.item_id,c2.`name`,b.score,count(b.score) as score_cnt
    from sd_assess_times a,sd_assess_score b,sd_assess_item c1,sd_assess_item c2
    where
    <if test="archiveNo != null">
      a.archive_no = #{archiveNo,jdbcType=VARCHAR} and
    </if>
    a.archive_no=b.archive_no and b.item_id=c1.item_id and c1.catalog_second=c2.item_id
    and c1.catalog_first = 8
    GROUP BY a.assess_times,c2.item_id,b.score
    ORDER BY a.assess_date,c2.item_id;
  </select>

</mapper>